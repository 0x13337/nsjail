<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="NsJail : A light-weight process isolation tool, making use of Linux namespaces and seccomp-bpf">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>NsJail</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/google/nsjail">View on GitHub</a>

          <h1 id="project_title">NsJail</h1>
          <h2 id="project_tagline">A light-weight process isolation tool, making use of Linux namespaces and seccomp-bpf</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/google/nsjail/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/google/nsjail/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h3>
<a id="what-is-it" class="anchor" href="#what-is-it" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>WHAT IS IT?</h3>

<p>NsJail is a process isolation tool for Linux. It makes use of the the namespacing, resource control, and seccomp-bpf syscall filter subsystems of the Linux kernel.</p>

<p>It can help, among others, with:</p>

<ul>
<li>Securing networking services (e.g. web, time, DNS), by isolating them from the rest of the OS</li>
<li>Hosting computer security challenges (so-called CTFs)</li>
<li>Containing invasive syscall-level OS fuzzers</li>
</ul>

<p>This is NOT an official Google product.</p>

<h3>
<a id="what-kind-of-isolation-does-this-tool-provide" class="anchor" href="#what-kind-of-isolation-does-this-tool-provide" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>WHAT KIND OF ISOLATION DOES THIS TOOL PROVIDE?</h3>

<ol>
<li>Linux namespaces: UTS (hostname), MOUNT (chroot), PID (separate PID tree), IPC, NET (separate networking context), USER</li>
<li>FS constraints: chroot(), pivot_root(), RO-remounting</li>
<li>Resource limits (wall-time/CPU time limits, VM/mem address space limits, etc.)</li>
<li>Programmable seccomp-bpf syscall filters</li>
<li>Cloned and separated Ethernet interfaces</li>
</ol>

<h3>
<a id="what-kind-of-use-cases-are-supported" class="anchor" href="#what-kind-of-use-cases-are-supported" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>WHAT KIND OF USE-CASES ARE SUPPORTED?</h3>

<h4>
<a id="isolation-of-network-services-inetd-style" class="anchor" href="#isolation-of-network-services-inetd-style" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Isolation of network services (inetd-style)</h4>

<ul>
<li>Server:</li>
</ul>

<pre><code> $ ./nsjail -Ml --port 9000 --chroot /chroot/ --user 99999 --group 99999 -- /bin/sh -i
</code></pre>

<ul>
<li>Client:</li>
</ul>

<pre><code> $ nc 127.0.0.1 9000
 / $ ifconfig
 / $ ifconfig -a
 lo    Link encap:Local Loopback
       LOOPBACK  MTU:65536  Metric:1
       RX packets:0 errors:0 dropped:0 overruns:0 frame:0
       TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0
       RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)
 / $ ps wuax
 PID   USER     COMMAND
 1 99999    /bin/sh -i
 3 99999    {busybox} ps wuax
 / $

</code></pre>

<h4>
<a id="isolation-with-access-to-a-private-cloned-interface-requires-euid0" class="anchor" href="#isolation-with-access-to-a-private-cloned-interface-requires-euid0" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Isolation, with access to a private, cloned interface (requires euid==0)</h4>

<pre><code>$ sudo ./nsjail --user 9999 --group 9999 --iface eth0 --chroot /chroot/ -Mo --iface_vs_ip 192.168.0.44 --iface_vs_nm 255.255.255.0 --iface_vs_gw 192.168.0.1 -- /bin/sh -i
/ $ id
uid=9999 gid=9999
/ $ ip addr sh
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue 
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: vs: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue 
    link/ether ca:a2:69:21:33:66 brd ff:ff:ff:ff:ff:ff
    inet 192.168.0.44/24 brd 192.168.0.255 scope global vs
       valid_lft forever preferred_lft forever
    inet6 fe80::c8a2:69ff:fe21:cd66/64 scope link 
       valid_lft forever preferred_lft forever
/ $ nc 217.146.165.209 80
GET / HTTP/1.0

HTTP/1.0 302 Found
Cache-Control: private
Content-Type: text/html; charset=UTF-8
Location: http://www.google.ch/?gfe_rd=cr&amp;ei=cEzWVrG2CeTI8ge88ofwDA
Content-Length: 258
Date: Wed, 02 Mar 2016 02:14:08 GMT

&lt;HTML&gt;&lt;HEAD&gt;&lt;meta http-equiv="content-type" content="text/html;charset=utf-8"&gt;
&lt;TITLE&gt;302 Moved&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;
&lt;H1&gt;302 Moved&lt;/H1&gt;
The document has moved
&lt;A HREF="http://www.google.ch/?gfe_rd=cr&amp;amp;ei=cEzWVrG2CeTI8ge88ofwDA"&gt;here&lt;/A&gt;.
&lt;/BODY&gt;&lt;/HTML&gt;
/ $ 
</code></pre>

<h4>
<a id="isolation-of-local-processes" class="anchor" href="#isolation-of-local-processes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Isolation of local processes</h4>

<pre><code> $ ./nsjail -Mo --chroot /chroot/ --user 99999 --group 99999 -- /bin/sh -i
 / $ ifconfig -a
 lo    Link encap:Local Loopback
       LOOPBACK  MTU:65536  Metric:1
       RX packets:0 errors:0 dropped:0 overruns:0 frame:0
       TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0
       RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)
 / $ id
 uid=99999 gid=99999
 / $ ps wuax
 PID   USER     COMMAND
 1 99999    /bin/sh -i
 4 99999    {busybox} ps wuax
 / $exit
 $
</code></pre>

<h4>
<a id="isolation-of-local-processes-and-re-running-them" class="anchor" href="#isolation-of-local-processes-and-re-running-them" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Isolation of local processes (and re-running them)</h4>

<pre><code> $ ./nsjail -Mr --chroot /chroot/ --user 99999 --group 99999 -- /bin/sh -i
 BusyBox v1.21.1 (Ubuntu 1:1.21.0-1ubuntu1) built-in shell (ash)
 Enter 'help' for a list of built-in commands.
 / $ ps wuax
 PID   USER     COMMAND
 1 99999    /bin/sh -i
 2 99999    {busybox} ps wuax
 / $ exit
 BusyBox v1.21.1 (Ubuntu 1:1.21.0-1ubuntu1) built-in shell (ash)
 Enter 'help' for a list of built-in commands.
 / $ ps wuax
 PID   USER     COMMAND
 1 99999    /bin/sh -i
 2 99999    {busybox} ps wuax
 / $
</code></pre>

<h3>
<a id="more-info" class="anchor" href="#more-info" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>MORE INFO?</h3>

<p>Type:</p>

<pre><code>./nsjail --help'
</code></pre>

<p>The commandline options are reasonably well-documented</p>

<pre><code>Usage: ./nsjail [options] -- path_to_command [args]
Options:
 --help|-h 
    Help plz..
 --mode|-M [val]
    Execution mode (default: l [MODE_LISTEN_TCP]):
    l: Wait for connections on a TCP port (specified with --port) [MODE_LISTEN_TCP]
    o: Immediately launch a single process on a console using clone/execve [MODE_STANDALONE_ONCE]
    e: Immediately launch a single process on a console using execve [MODE_STANDALONE_EXECVE]
    r: Immediately launch a single process on a console, keep doing it forever [MODE_STANDALONE_RERUN]
 --cmd 
    Equivalent of -Mo (MODE_STANDALONE_ONCE), run command on a local console, once
 --chroot|-c [val]
    Directory containing / of the jail (default: "/"). Skip mounting it if ""
 --rw 
    Mount / as RW (default: RO)
 --user|-u [val]
    Username/uid of processess inside the jail (default: your current uid). You can also use inside_ns_uid:outside_ns_uid convention here
 --group|-g [val]
    Groupname/gid of processess inside the jail (default: your current gid). You can also use inside_ns_gid:global_ns_gid convention here
 --hostname|-H [val]
    UTS name (hostname) of the jail (default: 'NSJAIL')
 --cwd|-D [val]
    Directory in the namespace the process will run (default: '/')
 --port|-p [val]
    TCP port to bind to (only in [MODE_LISTEN_TCP]) (default: 31337)
 --bindhost [val]
    IP address port to bind to (only in [MODE_LISTEN_TCP]) (default: '::')
 --max_conns_per_ip|-i [val]
    Maximum number of connections per one IP (default: 0 (unlimited))
 --log|-l [val]
    Log file (default: /proc/self/fd/2)
 --time_limit|-t [val]
    Maximum time that a jail can exist, in seconds (default: 600)
 --daemon|-d 
    Daemonize after start
 --verbose|-v 
    Verbose output
 --keep_env|-e 
    Should all environment variables be passed to the child?
 --env|-E [val]
    Environment variable (can be used multiple times)
 --keep_caps 
    Don't drop capabilities (DANGEROUS)
 --silent 
    Redirect child's fd:0/1/2 to /dev/null
 --disable_sandbox 
    Don't enable the seccomp-bpf sandboxing
 --skip_setsid 
    Don't call setsid(), allows for terminal signal handling in the sandboxed process
 --rlimit_as [val]
    RLIMIT_AS in MB, 'max' for RLIM_INFINITY, 'def' for the current value (default: 512)
 --rlimit_core [val]
    RLIMIT_CORE in MB, 'max' for RLIM_INFINITY, 'def' for the current value (default: 0)
 --rlimit_cpu [val]
    RLIMIT_CPU, 'max' for RLIM_INFINITY, 'def' for the current value (default: 600)
 --rlimit_fsize [val]
    RLIMIT_FSIZE in MB, 'max' for RLIM_INFINITY, 'def' for the current value (default: 1)
 --rlimit_nofile [val]
    RLIMIT_NOFILE, 'max' for RLIM_INFINITY, 'def' for the current value (default: 32)
 --rlimit_nproc [val]
    RLIMIT_NPROC, 'max' for RLIM_INFINITY, 'def' for the current value (default: 'def')
 --rlimit_stack [val]
    RLIMIT_STACK in MB, 'max' for RLIM_INFINITY, 'def' for the current value (default: 'def')
 --persona_addr_compat_layout 
    personality(ADDR_COMPAT_LAYOUT)
 --persona_mmap_page_zero 
    personality(MMAP_PAGE_ZERO)
 --persona_read_implies_exec 
    personality(READ_IMPLIES_EXEC)
 --persona_addr_limit_3gb 
    personality(ADDR_LIMIT_3GB)
 --persona_addr_no_randomize 
    personality(ADDR_NO_RANDOMIZE)
 --disable_clone_newnet|-N 
    Don't use CLONE_NEWNET. Enable networking inside the jail
 --disable_clone_newuser 
    Don't use CLONE_NEWUSER. Requires euid==0
 --disable_clone_newns 
    Don't use CLONE_NEWNS
 --disable_clone_newpid 
    Don't use CLONE_NEWPID
 --disable_clone_newipc 
    Don't use CLONE_NEWIPC
 --disable_clone_newuts 
    Don't use CLONE_NEWUTS
 --bindmount_ro|-R [val]
    List of mountpoints to be mounted --bind (ro) inside the container. Can be specified multiple times. Supports 'source' syntax, or 'source:dest'
 --bindmount|-B [val]
    List of mountpoints to be mounted --bind (rw) inside the container. Can be specified multiple times. Supports 'source' syntax, or 'source:dest'
 --tmpfsmount|-T [val]
    List of mountpoints to be mounted as RW/tmpfs inside the container. Can be specified multiple times. Supports 'dest' syntax
 --tmpfs_size [val]
    Number of bytes to allocate for tmpfsmounts (default: 4194304)
 --disable_proc 
    Disable mounting /proc in the jail
 --iface_no_lo 
    Don't bring up the 'lo' interface
 --iface|-I [val]
    Interface which will be cloned (MACVTAP) and put inside the subprocess' namespace as 'vs'
 --iface_vs_ip [val]
    IP of the 'vs' interface
 --iface_vs_nm [val]
    Netmask of the 'vs' interface
 --iface_vs_gw [val]
    Default GW for the 'vs' interface
</code></pre>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">NsJail maintained by <a href="https://github.com/google">google</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
